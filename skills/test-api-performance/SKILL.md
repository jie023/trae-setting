---
name: "test-api-performance"
description: "执行API性能与并发承载测试，包括高负载性能测试和多用户并发测试。支持Playwright MCP，适用于接口性能优化、上线前压测、性能回归测试等场景。"
---

# API性能与并发承载测试

## 技能概述

本技能用于执行API的性能与并发承载测试，验证系统在高负载下的可用性和稳定性，面向生产环境压测场景。

**技术栈**：Playwright MCP工具
**测试类型**：性能测试（响应时间、吞吐量）、并发测试（多用户并发）
**报告格式**：Markdown

## 测试场景

### 1. 性能测试用例
验证系统在高负载下的行为，包括响应时间、吞吐量、资源使用等指标。

**测试要点：**
- 单请求响应时间（最小值、最大值、平均值、P95、P99）
- 吞吐量（请求/秒）
- 并发请求处理能力
- CPU、内存、网络等资源使用情况
- 错误率
- 系统稳定性（长时间运行）

**性能指标：**
- **响应时间**：从发送请求到收到响应的时间
- **吞吐量**：单位时间内处理的请求数量（TPS/QPS）
- **并发数**：同时处理的请求数量
- **错误率**：失败请求占总请求的百分比
- **资源利用率**：CPU、内存、磁盘IO、网络IO的使用情况

### 2. 并发测试用例
验证系统在多个并发用户下的行为，确保系统在并发场景下的正确性和稳定性。

**测试要点：**
- 多用户同时访问同一接口
- 多用户并发创建/更新/删除资源
- 并发场景下的数据一致性
- 并发场景下的锁机制和事务处理
- 并发场景下的性能表现
- 死锁和竞态条件检测

**并发场景：**
- 读取并发：多个用户同时读取同一资源
- 写入并发：多个用户同时创建/更新同一资源
- 读写混合：同时进行读取和写入操作
- 批量操作并发：多个用户同时执行批量操作

## 测试检查清单

在执行测试前，请按以下清单逐项检查和执行：

### ✅ 准备阶段检查清单

- [ ] 确认已收集所有必要信息（业务名称、接口名称、URL、方法、参数等）
- [ ] 确认接口URL可访问
- [ ] 确认请求方法正确（GET/POST/PUT/DELETE/PATCH）
- [ ] 确认请求头配置正确（Content-Type等）
- [ ] 确认Token认证信息（如需要）已正确配置
- [ ] 确认性能基准已明确（响应时间、吞吐量等）
- [ ] 确认并发用户数已设定
- [ ] 确认测试时长已设定
- [ ] 确认测试数据准备就绪

### ✅ 性能测试检查清单

**单用户性能测试：**
- [ ] 发送单个请求
- [ ] 测量响应时间（最小值、最大值、平均值）
- [ ] 验证响应时间是否符合预期
- [ ] 记录单用户性能测试结果

**多用户性能测试：**
- [ ] 模拟多个并发用户
- [ ] 测量平均响应时间
- [ ] 测量吞吐量（请求/秒）
- [ ] 记录错误率
- [ ] 记录多用户性能测试结果

**压力测试：**
- [ ] 逐步增加并发用户数
- [ ] 测量系统极限性能
- [ ] 记录系统资源使用情况（CPU、内存、网络）
- [ ] 验证系统稳定性
- [ ] 记录压力测试结果

### ✅ 并发测试检查清单

**读取并发测试：**
- [ ] 多个用户同时读取同一资源
- [ ] 验证所有用户都能成功读取
- [ ] 记录响应时间
- [ ] 记录错误率
- [ ] 记录读取并发测试结果

**写入并发测试：**
- [ ] 多个用户同时创建资源
- [ ] 验证所有资源都成功创建
- [ ] 验证无数据冲突
- [ ] 记录响应时间
- [ ] 记录错误率
- [ ] 记录写入并发测试结果

**读写混合并发测试：**
- [ ] 同时进行读取和写入操作
- [ ] 验证读写操作互不影响
- [ ] 验证数据一致性得到保证
- [ ] 记录响应时间
- [ ] 记录错误率
- [ ] 记录读写混合并发测试结果

### ✅ 测试报告检查清单

- [ ] 所有性能测试已执行完成
- [ ] 所有并发测试已执行完成
- [ ] 响应时间数据已收集（最小值、最大值、平均值、P95、P99）
- [ ] 吞吐量数据已收集（TPS/QPS）
- [ ] 错误率已统计
- [ ] 资源使用情况已记录（CPU、内存、网络）
- [ ] 测试结果已记录（通过/失败）
- [ ] 性能瓶颈已识别（如有）
- [ ] 测试报告已生成并保存到指定目录
- [ ] 报告包含测试概览、性能指标、并发结果、结果统计

### ⚠️ 注意事项

- 每完成一个检查项，请及时标记为已完成
- 性能测试时注意监控系统资源使用情况
- 并发测试时注意检测死锁和竞态条件
- 如遇性能问题，需记录详细信息和复现步骤
- 如遇并发问题，需记录详细信息和复现步骤
- 测试过程中如发现问题，及时记录并反馈
- 确保测试报告包含完整的性能指标和统计数据

## 测试执行流程

### 步骤1：收集测试信息

在开始测试前，需要收集以下信息：

- **业务名称**：用于组织测试报告目录
- **接口名称**：被测试的API接口名称
- **接口URL**：完整的API端点地址
- **请求方法**：GET、POST、PUT、DELETE等
- **请求头**：Content-Type等
- **请求参数**：参数列表、类型、是否必填、取值范围
- **性能基准**：预期的响应时间、吞吐量等指标
- **并发用户数**：测试的并发用户数量
- **测试时长**：每个测试场景的持续时间
- **认证信息**（可选）：如需认证，提供Token键值对列表（支持多个token）
  - Token 1的key：例如 Authorization、token、X-Auth-Token、lesseeadmintoken、lesseemanagetoken
  - Token 1的value：例如 eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9（直接提供token值，无需添加"Bearer"前缀）
  - Token 2的key：（如需要多个token，继续提供）
  - Token 2的value：（如需要多个token，继续提供）
  - 以此类推...

### 步骤2：执行性能测试

使用Playwright MCP工具执行性能测试：

**支持的HTTP方法：**
- GET：查询数据
- POST：创建数据
- PUT：更新数据（全量）
- PATCH：更新数据（部分）
- DELETE：删除数据

**测试执行流程：**

1. **单用户性能测试**：
   - 发送单个请求
   - 测量响应时间
   - 验证响应时间是否符合预期

2. **多用户性能测试**：
   - 模拟多个并发用户
   - 测量平均响应时间
   - 测量吞吐量（请求/秒）
   - 记录错误率

3. **压力测试**：
   - 逐步增加并发用户数
   - 测量系统极限性能
   - 记录系统资源使用情况
   - 验证系统稳定性

### 步骤3：执行并发测试

使用Playwright MCP工具执行并发测试：

1. **读取并发测试**：
   - 多个用户同时读取同一资源
   - 验证所有用户都能成功读取
   - 记录响应时间和错误率

2. **写入并发测试**：
   - 多个用户同时创建资源
   - 验证所有资源都成功创建
   - 验证无数据冲突

3. **读写混合并发测试**：
   - 同时进行读取和写入操作
   - 验证读写操作互不影响
   - 验证数据一致性得到保证

### 步骤4：生成测试报告

测试完成后，生成Markdown格式的测试报告，报告保存在以下目录：
```
doc/{业务名称}/测试报告/性能与并发承载/{测试接口名称}_{时间戳}.md
```
