---
name: "test-api-data-quality"
description: "执行API数据质量保障测试，包括数据一致性测试和数据完整性测试。支持Playwright MCP，适用于数据迁移、数据修复、数据质量监控等场景。"
---

# API数据质量保障测试

## 技能概述

本技能用于执行API的数据质量保障测试，验证数据全生命周期的有效性，面向数据可靠性。

**技术栈**：Playwright MCP工具
**测试类型**：数据质量测试（数据一致性、数据完整性）
**报告格式**：Markdown

## 测试场景

### 1. 数据一致性测试用例
验证数据在不同操作之间的一致性，确保数据在系统各个层面保持一致。

**测试要点：**
- 读写一致性：写入后立即读取，验证数据是否一致
- 跨服务一致性：多个服务间的数据同步是否正确
- 分布式一致性：分布式环境下的数据一致性
- 缓存一致性：缓存与数据存储的一致性
- 事务一致性：事务操作的数据一致性
- 版本一致性：数据版本管理的一致性

### 2. 数据完整性测试用例
验证数据在存储和处理过程中的完整性，确保数据未被篡改或丢失。

**测试要点：**
- 数据准确性：存储的数据与输入数据是否一致
- 数据完整性：数据是否完整，无缺失或损坏
- 数据唯一性：唯一标识符是否唯一
- 数据格式：数据格式是否符合规范
- 数据范围：数据值是否在允许范围内
- 数据关联：关联数据是否正确关联
- 数据校验：数据校验机制是否有效
- 数据恢复：数据备份和恢复是否可靠

## 测试检查清单

在执行测试前，请按以下清单逐项检查和执行：

### ✅ 准备阶段检查清单

- [ ] 确认已收集所有必要信息（业务名称、接口名称、URL、方法、参数等）
- [ ] 确认接口URL可访问
- [ ] 确认请求方法正确（GET/POST/PUT/DELETE/PATCH）
- [ ] 确认请求头配置正确（Content-Type等）
- [ ] 确认Token认证信息（如需要）已正确配置
- [ ] 确认数据结构和关联关系已明确
- [ ] 确认测试数据准备就绪

### ✅ 数据一致性测试检查清单

**读写一致性：**
- [ ] 创建数据后立即读取并验证一致性
- [ ] 更新数据后立即读取并验证一致性
- [ ] 删除数据后验证不存在
- [ ] 记录读写一致性测试结果

**跨服务一致性：**
- [ ] 在多个服务间创建数据
- [ ] 验证各服务数据是否同步
- [ ] 记录跨服务一致性测试结果

**缓存一致性：**
- [ ] 写入数据后验证缓存更新
- [ ] 更新数据后验证缓存失效
- [ ] 验证缓存与数据存储一致性
- [ ] 记录缓存一致性测试结果

**事务一致性：**
- [ ] 执行成功事务验证数据一致性
- [ ] 执行失败事务验证数据回滚
- [ ] 记录事务一致性测试结果

### ✅ 数据完整性测试检查清单

**数据准确性：**
- [ ] 写入字符串数据并验证准确性
- [ ] 写入数值数据并验证准确性
- [ ] 写入日期时间数据并验证准确性

**数据完整性：**
- [ ] 写入长文本数据并验证完整性
- [ ] 写入特殊字符数据并验证完整性
- [ ] 写入Unicode字符数据并验证完整性

**数据唯一性：**
- [ ] 创建相同主键数据验证唯一性
- [ ] 创建相同业务键数据验证唯一性

**数据格式：**
- [ ] 验证邮箱格式正确性
- [ ] 验证手机号格式正确性
- [ ] 验证日期格式正确性

**数据范围：**
- [ ] 验证最小值边界
- [ ] 验证最大值边界
- [ ] 验证超出范围值被拒绝

**数据关联：**
- [ ] 创建关联数据验证外键关联
- [ ] 删除主数据验证级联删除

**数据校验：**
- [ ] 提交缺少必填字段数据验证校验
- [ ] 提交错误类型数据验证校验

### ✅ 测试报告检查清单

- [ ] 所有数据一致性测试已执行完成
- [ ] 所有数据完整性测试已执行完成
- [ ] 测试结果已记录（通过/失败）
- [ ] 失败用例已记录详细错误信息
- [ ] 数据不一致问题已记录
- [ ] 数据不完整问题已记录
- [ ] 测试报告已生成并保存到指定目录
- [ ] 报告包含测试概览、用例详情、结果统计

### ⚠️ 注意事项

- 每完成一个检查项，请及时标记为已完成
- 如遇数据不一致问题，需记录详细信息和复现步骤
- 如遇数据不完整问题，需记录详细信息和复现步骤
- 测试过程中如发现问题，及时记录并反馈
- 确保测试报告包含完整的测试结果和统计数据

## 测试执行流程

### 步骤1：收集测试信息

在开始测试前，需要收集以下信息：

- **业务名称**：用于组织测试报告目录
- **接口名称**：被测试的API接口名称
- **接口URL**：完整的API端点地址
- **请求方法**：GET、POST、PUT、DELETE等
- **请求头**：Content-Type等
- **请求参数**：参数列表、类型、是否必填、取值范围
- **数据结构**：数据的字段定义和约束
- **关联关系**：数据之间的关联关系
- **认证信息**（可选）：如需认证，提供Token键值对列表（支持多个token）
  - Token 1的key：例如 Authorization、token、X-Auth-Token、lesseeadmintoken、lesseemanagetoken
  - Token 1的value：例如 eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9（直接提供token值，无需添加"Bearer"前缀）
  - Token 2的key：（如需要多个token，继续提供）
  - Token 2的value：（如需要多个token，继续提供）
  - 以此类推...

### 步骤2：执行数据一致性测试

使用Playwright MCP工具执行数据一致性测试：

**支持的HTTP方法：**
- GET：查询数据
- POST：创建数据
- PUT：更新数据（全量）
- PATCH：更新数据（部分）
- DELETE：删除数据

**测试执行流程：**

1. **读写一致性测试**：
   - 创建数据后立即读取
   - 更新数据后立即读取
   - 删除数据后验证不存在
   - 验证读写数据是否一致

2. **跨服务一致性测试**：
   - 在多个服务间创建数据
   - 验证各服务数据是否同步
   - 验证跨服务数据一致性

3. **缓存一致性测试**：
   - 写入数据后验证缓存更新
   - 更新数据后验证缓存失效
   - 验证缓存与数据存储一致性

4. **事务一致性测试**：
   - 执行成功事务验证数据一致性
   - 执行失败事务验证数据回滚
   - 验证事务操作的数据一致性

### 步骤3：执行数据完整性测试

使用Playwright MCP工具执行数据完整性测试：

1. **数据准确性测试**：
   - 写入字符串数据并验证准确性
   - 写入数值数据并验证准确性
   - 写入日期时间数据并验证准确性

2. **数据完整性测试**：
   - 写入长文本数据并验证完整性
   - 写入特殊字符数据并验证完整性
   - 写入Unicode字符数据并验证完整性

3. **数据唯一性测试**：
   - 创建相同主键数据验证唯一性
   - 创建相同业务键数据验证唯一性

4. **数据格式测试**：
   - 验证邮箱格式正确性
   - 验证手机号格式正确性
   - 验证日期格式正确性

5. **数据范围测试**：
   - 验证最小值边界
   - 验证最大值边界
   - 验证超出范围值被拒绝

6. **数据关联测试**：
   - 创建关联数据验证外键关联
   - 删除主数据验证级联删除

7. **数据校验测试**：
   - 提交缺少必填字段数据验证校验
   - 提交错误类型数据验证校验

### 步骤4：生成测试报告

测试完成后，生成Markdown格式的测试报告，报告保存在以下目录：
```
doc/{业务名称}/测试报告/数据质量保障/{测试接口名称}_{时间戳}.md
```
